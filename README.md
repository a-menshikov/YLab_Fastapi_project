# YLab_Fastapi_project ДЗ №4

Я постарался максимально облегчить процесс запуска проекта, поэтому все неободимые .env файлы уже внутри репозитория для удобства. Для запуска потребуется docker compose.

## Запуск

### **Запуск проекта на локальном компьютере**

1. Клонировать репозиторий

    ```bash
    git clone <ссылка с git-hub>
    ```

2. Перейти в папку /YLab_Fastapi_project

3. Поднять контейнеры в фоновом режиме

    ```bash
    docker compose up -d
    ```

4. Чтобы прекратить работу контейнеров воспользуётсь командой

    ```bash
    docker compose down
    ```

    Если хотите прекратить работу контейнеров с удалением томов, то дополните команду флагом -v

    ```bash
    docker compose down -v
    ```

5. Документация доступна по адресу <http://127.0.0.1:8000/docs>

### **Запуск проекта с прохождением тестов через pytest**

Для прогона написанных мной тестов подготовлен отдельный вариант файла docker compose.
Сценарий тестирования предполагает старт контейнеров, вывод результатов прохождения тестов на экран и удаление контейнеров вместе с томами.

Если проект был запущен локально раньше, то для стабильного запуска по данной инструкции необходимо остановить ранее запущенный сервис, удалить контейнеры, тома и образы, которые использовались для него.

1. Для запуска сценария необходимо после клонирования репозитория выполнить в папке /YLab_Fastapi_project следующую команду

    ```bash
    docker compose -f docker-compose-pytest.yml up -d && docker logs --follow backend && docker compose -f docker-compose-pytest.yml down -v
    ```

### **Запуск проекта с прохождением тестов через Postman**

Для прогона тестов из самого первого задания подготовлен отдельный вариант файла docker compose.
Это то же самое приложение, но без контейнеров раббита и селери, так как с наполняемой из файла базой данных ожидаемых ответов постман уже не получает и возникают конфликты данных (сценарий постмана наполняет, селери удаляет, так как их нет в файле).

Если проект был запущен локально раньше, то для стабильного запуска по данной инструкции необходимо остановить ранее запущенный сервис, удалить контейнеры, тома и образы, которые использовались для него.

1. Для запуска сценария необходимо после клонирования репозитория выполнить в папке /YLab_Fastapi_project следующую команду

    ```bash
    docker compose -f docker-compose-postman.yml up -d
    ```

2. Чтобы завершить работу сервиса воспользуйтесь командой

    ```bash
    docker compose -f docker-compose-postman.yml down -v
    ```

## Комментарии к 4-му ДЗ

1. Celery-задача.

    - реализация находится в папке tasks/. Представлена двумя отдельными репозиториями парсера и обработчика. Оперирование данными производится с помощью эндпоинтов ранее написанного API.
    - в контейнере приложения файл с меню находится в папке /code/app/admin/
    - успешность использования автоматического наполнения базы из файла сильно зависит от соблюдения правил форматирования таблицы.Все поля для каждой сущности должны быть заполнены валидными данными. Если данные невалидны - каждую итерацию будут проходить неудачные запросы к API.
    - при добавлении строки с новой сущностью необходимо добавить также ее uuid в соответствующую ячейку. для генерации uuid-ов рекомендую использовать [этот ресурс](https://www.uuidgenerator.net/).
    - поле цены требуется вводить в формате двух знаков после запятой.
    - решение полностью рабочее и при правильном использовании файла без ошибок - всё будет отлично работать, если файл вести с ошибками - будут проблемы. При наличии большего времени, я бы уделил больше внимания обработке кейсов из серии "что может пойти не так" и убеждению заказчика, что ведение админки в экселе - очень сильно нестабильное решение - давайте лучше делаем простенькую веб-версию сайта администратора. А пока надеемся, что наш пользователь молодец и не будет испытывать решение на прочность.

2. Фоновые задачи для кэша.

    - принял решение увести в фоновые задачи не только инвалидацию кэша, но и установку значений. Таким образом вся работа с кэшем проходит в фоне. Тесты проходят успешно, проблем с работой не наблюдается.

3. Новый эндпоинт.

    - полная информация по всем объектам базы в древовидной структуре доступна по новому эндпоинту **{{LOCAL_URL}}/api/v1/fullbase**
    - тесты для нового эндпоинта находятся в файле tests/test_05_fullbase_endpiont.py

## Задачки со звездочкой

1. **Реализовать тестовый сценарий «Проверка кол-ва блюд и подменю в меню» из Postman с помощью pytest**

    Сценарий реализован в файле tests/test_04_counter.py

2. **Описать ручки API в соответствий c OpenAPI**

    В целом сваггер достаточно неплохо справляется с документированием, поэтому доделал не слишком много. Разбил ручки на теги и добавил описания, форматы ответов, статусы.

3. **Реализовать в тестах аналог Django reverse() для FastAPI**

    Реализация находится в файле tests/service.py  
    Функция так и названа reverse()  
    При первом обращении собираю для нее словарь значений из всех маршрутов зарегистрированных в приложении в формате ключ - имя функции привязанной к эндпоинту, значение - путь к этому эндпоинту. При использовании в тестах по названию фунцкции получаю путь и возвращаю форматированную переданными аргументами строку.

Это мой первый опыт работы с фреймворком FastAPI.  
Благодарю за возможность участвовать в интенсиве и учиться. Опыт за время написания проекта я получил колоссальный. Из всего стека о этого видел только алхимию.  
Готов ответить на любые вопросы по проекту и буду благодарен за обратную связь.  
Надеюсь на встречу на собеседании))  

Мои контакты:  
telegram - @Menshikov_AS  
email - <a.menshikov1989@gmail.com>
